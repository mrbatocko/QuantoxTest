var UIController=function(){var e,t,o=function(){var o="",n=document.querySelector(".app-locations-wrapper");e.forEach(function(e){var n='<div class="app-location"><div class="app-location__info"><h3 class="app-location__bank-name">%name%</h3><p class="app-location__distance">%distance% km</p></div><img class="app-location__image" src="%image%"></div>',a=new google.maps.LatLng(t.coords.latitude,t.coords.longitude),r=new google.maps.LatLng(e.geometry.location.lat(),e.geometry.location.lng());n=(n=n.replace("%distance%",(Math.round(google.maps.geometry.spherical.computeDistanceBetween(a,r))/1e3).toFixed(2))).replace("%name%",e.name);var c="https://maps.googleapis.com/maps/api/staticmap?center=%vicinity%&zoom=14&size=600x300&maptype=roadmap&markers=color:blue%7C%lat%,%lng%&key=AIzaSyAKx0Hrnc77Lkhu3y4zTLCr8cdnNuoQzI4";c=(c=(c=c.replace("%vicinity%",e.vicinity)).replace("%lat%",e.geometry.location.lat())).replace("%lng%",e.geometry.location.lng()),n=n.replace("%image%",c),o+=n}),n.insertAdjacentHTML("beforeend",o)};return{displayResults:function(n,a){e=n,t=a,o()},resultsAvailableChange:function(){document.querySelector(".loader").classList.remove("loader--loading"),document.querySelector(".app-header__content").classList.add("app-header__content--hidden"),document.querySelector(".app-locations").classList.add("app-locations--visible")},awaitingResults:function(){document.querySelector(".loader").classList.add("loader--loading")},sortByDistance:function(){var e=document.querySelector(".app-locations-wrapper"),t=document.querySelectorAll(".app-location");Array.prototype.map.call(t,function(e){return{nodeToSort:e,distance:e.getElementsByClassName("app-location__distance")[0].innerHTML.replace(" km","")}}).sort(function(e,t){return e.distance==t.distance?0:e.distance>t.distance?1:-1}).forEach(function(t){e.appendChild(t.nodeToSort)})},showMultiCurrencyOnly:function(){var e=document.querySelector(".app-locations-wrapper"),t=document.querySelectorAll(".app-location"),o=new RegExp("telenor","i");Array.prototype.filter.call(t,function(e){return!o.test(e.getElementsByClassName("app-location__bank-name")[0].innerHTML)}).forEach(function(t){e.removeChild(t)}),0===e.querySelectorAll(".app-location").length&&document.querySelector(".app-locations__no-multi-currency").classList.add("app-locations__no-multi-currency--visible")}}}(),MapController=function(){var e;return{findNearbyATMs:function(t){e=new google.maps.LatLng(t.coords.latitude,t.coords.longitude);var o=new google.maps.Map(document.getElementById("map"),{center:e,zoom:15}),n={location:e,radius:"2000",types:["atm"]},a=new google.maps.places.PlacesService(o);return new Promise(function(t,o){a.nearbySearch(n,function(n,a){a==google.maps.places.PlacesServiceStatus.OK?t(n,e):o(a)})})}}}(),AppController=function(e,t){function o(n){var a=document.querySelector(".app-header__content");if("geolocation"in navigator)navigator.geolocation.getCurrentPosition(function(o){e.awaitingResults(),t.findNearbyATMs(o).then(function(t){e.resultsAvailableChange(),e.displayResults(t,o)})},function(e){if(e.code===e.PERMISSION_DENIED){n.target.removeEventListener("click",o);a.insertAdjacentHTML("beforeend",'<p class="app-header__init-error">You must allow geolocation. Refresh and try again.</p>')}});else{n.target.removeEventListener("click",o);a.insertAdjacentHTML("beforeend",'<p class="app-header__init-error">Your browser does not support geolocation. Please try another one.</p>')}}return{init:function(){var t=document.querySelector("#app-init"),n=document.querySelector("#app-sort-results"),a=document.querySelector("#app-multi-currency-only");t.addEventListener("click",o),n.addEventListener("click",function(t){e.sortByDistance()}),a.addEventListener("click",function(t){e.showMultiCurrencyOnly()})}}}(UIController,MapController);AppController.init();